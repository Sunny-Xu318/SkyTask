{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport { computed } from 'vue';\nimport BaseChart from '../charts/BaseChart.vue';\nexport default {\n  __name: 'TaskDependencyGraph',\n  props: {\n    taskName: {\n      type: String,\n      default: ''\n    },\n    dependencies: {\n      type: Array,\n      default: () => []\n    }\n  },\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const props = __props;\n    const hasGraph = computed(() => Array.isArray(props.dependencies) && props.dependencies.length > 0);\n    const chartOptions = computed(() => {\n      if (!hasGraph.value) {\n        return {};\n      }\n      const nodes = [];\n      const links = [];\n      const rootId = 'root';\n      nodes.push({\n        id: rootId,\n        name: props.taskName || '当前任务',\n        symbolSize: 64,\n        itemStyle: {\n          color: '#2563eb'\n        },\n        label: {\n          fontWeight: 'bold'\n        }\n      });\n      props.dependencies.forEach((dep, index) => {\n        const nodeId = String(dep.id ?? index);\n        const status = (dep.status || 'UNKNOWN').toUpperCase();\n        let color = '#94a3b8';\n        if (status === 'SUCCESS') color = '#22c55e';else if (status === 'FAILED') color = '#ef4444';else if (status === 'RUNNING') color = '#f97316';\n        nodes.push({\n          id: nodeId,\n          name: dep.name || `任务 ${index + 1}`,\n          symbolSize: 48,\n          itemStyle: {\n            color\n          },\n          value: status,\n          tooltip: {\n            formatter: () => {\n              const parts = [`<strong>${dep.name || `任务 ${index + 1}`}</strong>`, `状态: ${status}`, dep.cronExpr ? `Cron: ${dep.cronExpr}` : null, dep.node ? `节点: ${dep.node}` : null].filter(Boolean);\n              return parts.join('<br/>');\n            }\n          }\n        });\n        links.push({\n          source: rootId,\n          target: nodeId\n        });\n      });\n      return {\n        tooltip: {\n          trigger: 'item',\n          enterable: true\n        },\n        legend: {\n          show: false\n        },\n        series: [{\n          type: 'graph',\n          layout: 'force',\n          roam: true,\n          focusNodeAdjacency: true,\n          draggable: true,\n          data: nodes,\n          links,\n          force: {\n            repulsion: 1400,\n            edgeLength: 140,\n            gravity: 0.2\n          },\n          lineStyle: {\n            color: '#94a3b8',\n            width: 2,\n            curveness: 0.2\n          },\n          label: {\n            color: '#0f172a'\n          }\n        }]\n      };\n    });\n    const __returned__ = {\n      props,\n      hasGraph,\n      chartOptions,\n      computed,\n      BaseChart\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["computed","BaseChart","props","__props","hasGraph","Array","isArray","dependencies","length","chartOptions","value","nodes","links","rootId","push","id","name","taskName","symbolSize","itemStyle","color","label","fontWeight","forEach","dep","index","nodeId","String","status","toUpperCase","tooltip","formatter","parts","cronExpr","node","filter","Boolean","join","source","target","trigger","enterable","legend","show","series","type","layout","roam","focusNodeAdjacency","draggable","data","force","repulsion","edgeLength","gravity","lineStyle","width","curveness"],"sources":["D:/桌面/项目/分布式任务调度系统/SkyTask-main/SkyTask-main/skytask-frontend/src/components/task/TaskDependencyGraph.vue"],"sourcesContent":["<template>\n  <div class=\"dependency-graph\">\n    <BaseChart\n      v-if=\"hasGraph\"\n      :options=\"chartOptions\"\n      class=\"dependency-graph__chart\"\n    />\n    <el-empty v-else description=\"暂无依赖信息\" />\n  </div>\n</template>\n\n<script setup>\nimport { computed } from 'vue';\nimport BaseChart from '../charts/BaseChart.vue';\n\nconst props = defineProps({\n  taskName: {\n    type: String,\n    default: ''\n  },\n  dependencies: {\n    type: Array,\n    default: () => []\n  }\n});\n\nconst hasGraph = computed(() => Array.isArray(props.dependencies) && props.dependencies.length > 0);\n\nconst chartOptions = computed(() => {\n  if (!hasGraph.value) {\n    return {};\n  }\n\n  const nodes = [];\n  const links = [];\n  const rootId = 'root';\n\n  nodes.push({\n    id: rootId,\n    name: props.taskName || '当前任务',\n    symbolSize: 64,\n    itemStyle: { color: '#2563eb' },\n    label: { fontWeight: 'bold' }\n  });\n\n  props.dependencies.forEach((dep, index) => {\n    const nodeId = String(dep.id ?? index);\n    const status = (dep.status || 'UNKNOWN').toUpperCase();\n    let color = '#94a3b8';\n    if (status === 'SUCCESS') color = '#22c55e';\n    else if (status === 'FAILED') color = '#ef4444';\n    else if (status === 'RUNNING') color = '#f97316';\n\n    nodes.push({\n      id: nodeId,\n      name: dep.name || `任务 ${index + 1}`,\n      symbolSize: 48,\n      itemStyle: { color },\n      value: status,\n      tooltip: {\n        formatter: () => {\n          const parts = [\n            `<strong>${dep.name || `任务 ${index + 1}`}</strong>`,\n            `状态: ${status}`,\n            dep.cronExpr ? `Cron: ${dep.cronExpr}` : null,\n            dep.node ? `节点: ${dep.node}` : null\n          ].filter(Boolean);\n          return parts.join('<br/>');\n        }\n      }\n    });\n    links.push({ source: rootId, target: nodeId });\n  });\n\n  return {\n    tooltip: { trigger: 'item', enterable: true },\n    legend: { show: false },\n    series: [\n      {\n        type: 'graph',\n        layout: 'force',\n        roam: true,\n        focusNodeAdjacency: true,\n        draggable: true,\n        data: nodes,\n        links,\n        force: {\n          repulsion: 1400,\n          edgeLength: 140,\n          gravity: 0.2\n        },\n        lineStyle: {\n          color: '#94a3b8',\n          width: 2,\n          curveness: 0.2\n        },\n        label: {\n          color: '#0f172a'\n        }\n      }\n    ]\n  };\n});\n</script>\n\n<style scoped>\n.dependency-graph {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  min-height: 320px;\n}\n\n.dependency-graph__chart {\n  width: 100%;\n  height: 320px;\n}\n</style>\n"],"mappings":";;;AAYA,SAASA,QAAQ,QAAQ,KAAK;AAC9B,OAAOC,SAAS,MAAM,yBAAyB;;;;;;;;;;;;;;;;;IAE/C,MAAMC,KAAK,GAAGC,OASZ;IAEF,MAAMC,QAAQ,GAAGJ,QAAQ,CAAC,MAAMK,KAAK,CAACC,OAAO,CAACJ,KAAK,CAACK,YAAY,CAAC,IAAIL,KAAK,CAACK,YAAY,CAACC,MAAM,GAAG,CAAC,CAAC;IAEnG,MAAMC,YAAY,GAAGT,QAAQ,CAAC,MAAM;MAClC,IAAI,CAACI,QAAQ,CAACM,KAAK,EAAE;QACnB,OAAO,CAAC,CAAC;MACX;MAEA,MAAMC,KAAK,GAAG,EAAE;MAChB,MAAMC,KAAK,GAAG,EAAE;MAChB,MAAMC,MAAM,GAAG,MAAM;MAErBF,KAAK,CAACG,IAAI,CAAC;QACTC,EAAE,EAAEF,MAAM;QACVG,IAAI,EAAEd,KAAK,CAACe,QAAQ,IAAI,MAAM;QAC9BC,UAAU,EAAE,EAAE;QACdC,SAAS,EAAE;UAAEC,KAAK,EAAE;QAAU,CAAC;QAC/BC,KAAK,EAAE;UAAEC,UAAU,EAAE;QAAO;MAC9B,CAAC,CAAC;MAEFpB,KAAK,CAACK,YAAY,CAACgB,OAAO,CAAC,CAACC,GAAG,EAAEC,KAAK,KAAK;QACzC,MAAMC,MAAM,GAAGC,MAAM,CAACH,GAAG,CAACT,EAAE,IAAIU,KAAK,CAAC;QACtC,MAAMG,MAAM,GAAG,CAACJ,GAAG,CAACI,MAAM,IAAI,SAAS,EAAEC,WAAW,CAAC,CAAC;QACtD,IAAIT,KAAK,GAAG,SAAS;QACrB,IAAIQ,MAAM,KAAK,SAAS,EAAER,KAAK,GAAG,SAAS,MACtC,IAAIQ,MAAM,KAAK,QAAQ,EAAER,KAAK,GAAG,SAAS,MAC1C,IAAIQ,MAAM,KAAK,SAAS,EAAER,KAAK,GAAG,SAAS;QAEhDT,KAAK,CAACG,IAAI,CAAC;UACTC,EAAE,EAAEW,MAAM;UACVV,IAAI,EAAEQ,GAAG,CAACR,IAAI,IAAI,MAAMS,KAAK,GAAG,CAAC,EAAE;UACnCP,UAAU,EAAE,EAAE;UACdC,SAAS,EAAE;YAAEC;UAAM,CAAC;UACpBV,KAAK,EAAEkB,MAAM;UACbE,OAAO,EAAE;YACPC,SAAS,EAAEA,CAAA,KAAM;cACf,MAAMC,KAAK,GAAG,CACZ,WAAWR,GAAG,CAACR,IAAI,IAAI,MAAMS,KAAK,GAAG,CAAC,EAAE,WAAW,EACnD,OAAOG,MAAM,EAAE,EACfJ,GAAG,CAACS,QAAQ,GAAG,SAAST,GAAG,CAACS,QAAQ,EAAE,GAAG,IAAI,EAC7CT,GAAG,CAACU,IAAI,GAAG,OAAOV,GAAG,CAACU,IAAI,EAAE,GAAG,IAAG,CACnC,CAACC,MAAM,CAACC,OAAO,CAAC;cACjB,OAAOJ,KAAK,CAACK,IAAI,CAAC,OAAO,CAAC;YAC5B;UACF;QACF,CAAC,CAAC;QACFzB,KAAK,CAACE,IAAI,CAAC;UAAEwB,MAAM,EAAEzB,MAAM;UAAE0B,MAAM,EAAEb;QAAO,CAAC,CAAC;MAChD,CAAC,CAAC;MAEF,OAAO;QACLI,OAAO,EAAE;UAAEU,OAAO,EAAE,MAAM;UAAEC,SAAS,EAAE;QAAK,CAAC;QAC7CC,MAAM,EAAE;UAAEC,IAAI,EAAE;QAAM,CAAC;QACvBC,MAAM,EAAE,CACN;UACEC,IAAI,EAAE,OAAO;UACbC,MAAM,EAAE,OAAO;UACfC,IAAI,EAAE,IAAI;UACVC,kBAAkB,EAAE,IAAI;UACxBC,SAAS,EAAE,IAAI;UACfC,IAAI,EAAEvC,KAAK;UACXC,KAAK;UACLuC,KAAK,EAAE;YACLC,SAAS,EAAE,IAAI;YACfC,UAAU,EAAE,GAAG;YACfC,OAAO,EAAE;UACX,CAAC;UACDC,SAAS,EAAE;YACTnC,KAAK,EAAE,SAAS;YAChBoC,KAAK,EAAE,CAAC;YACRC,SAAS,EAAE;UACb,CAAC;UACDpC,KAAK,EAAE;YACLD,KAAK,EAAE;UACT;QACF;MAEJ,CAAC;IACH,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}