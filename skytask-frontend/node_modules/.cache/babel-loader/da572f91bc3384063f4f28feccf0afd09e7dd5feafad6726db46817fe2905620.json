{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport { computed, onMounted, ref } from 'vue';\nimport { useRoute, useRouter } from 'vue-router';\nimport { useStore } from 'vuex';\nimport { ElMessage } from 'element-plus';\nimport dayjs from 'dayjs';\nimport StatusTag from '@/components/common/StatusTag.vue';\nimport TaskFormDrawer from '@/components/task/TaskFormDrawer.vue';\nimport TaskDependencyGraph from '@/components/task/TaskDependencyGraph.vue';\nimport BaseChart from '@/components/charts/BaseChart.vue';\nexport default {\n  __name: 'TaskDetailView',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const store = useStore();\n    const route = useRoute();\n    const router = useRouter();\n    const taskId = route.params.taskId;\n    const drawerVisible = ref(false);\n    const submitting = ref(false);\n    const logVisible = ref(false);\n    const activeLog = ref('');\n    const triggering = ref(false);\n    const detailLoading = ref(false);\n    const chartRange = ref('24h');\n    const groupOptions = [{\n      label: 'Data Report',\n      value: 'DATA_REPORT'\n    }, {\n      label: 'Realtime Risk',\n      value: 'RISK_CONTROL'\n    }, {\n      label: 'Marketing',\n      value: 'MARKETING'\n    }, {\n      label: 'Recommendation',\n      value: 'RECOMMEND'\n    }];\n    const ownerOptions = [{\n      label: 'Alice - Data Platform',\n      value: 'alice'\n    }, {\n      label: 'Bob - Marketing',\n      value: 'bob'\n    }, {\n      label: 'Carol - Settlement',\n      value: 'carol'\n    }, {\n      label: 'David - Recommendation',\n      value: 'david'\n    }];\n    const tagOptions = ['report', 'risk', 'cache', 'recommend', 'marketing', 'settlement'];\n    const parseError = error => error?.response?.data?.message || error?.message || '操作失败，请稍后重试';\n\n    // 统一的日期转换函数\n    const parseTriggerTime = triggerTime => {\n      if (!triggerTime) {\n        return null;\n      }\n\n      // 如果已经是字符串，直接返回\n      if (typeof triggerTime === 'string') {\n        return triggerTime;\n      }\n\n      // 如果是对象（OffsetDateTime 序列化结果），尝试转换\n      if (typeof triggerTime === 'object') {\n        const {\n          year,\n          monthValue,\n          month,\n          dayOfMonth,\n          day,\n          hour,\n          minute,\n          second\n        } = triggerTime;\n        const y = year;\n        let m = monthValue || month;\n        const d = dayOfMonth || day;\n        const h = hour || 0;\n        const min = minute || 0;\n        const s = second || 0;\n\n        // 如果 month 是字符串（如\"OCTOBER\"），转换为数字\n        if (typeof m === 'string') {\n          const monthMap = {\n            'JANUARY': 1,\n            'FEBRUARY': 2,\n            'MARCH': 3,\n            'APRIL': 4,\n            'MAY': 5,\n            'JUNE': 6,\n            'JULY': 7,\n            'AUGUST': 8,\n            'SEPTEMBER': 9,\n            'OCTOBER': 10,\n            'NOVEMBER': 11,\n            'DECEMBER': 12\n          };\n          m = monthMap[m.toUpperCase()] || parseInt(m);\n        }\n        if (y && m && d) {\n          try {\n            // 使用 JavaScript Date 对象构建日期，确保兼容性\n            const date = dayjs(new Date(y, m - 1, d, h, min, s));\n            if (date.isValid()) {\n              return date.format('YYYY-MM-DDTHH:mm:ss');\n            }\n          } catch (error) {\n            console.error('日期构建异常:', error);\n          }\n        }\n      }\n      return String(triggerTime);\n    };\n    onMounted(async () => {\n      detailLoading.value = true;\n      try {\n        await store.dispatch('tasks/loadTaskDetail', taskId);\n        await loadExecutions();\n      } catch (error) {\n        ElMessage.error(parseError(error));\n      } finally {\n        detailLoading.value = false;\n      }\n    });\n    const detail = computed(() => store.getters['tasks/currentTask'] || {});\n    const executions = computed(() => store.getters['tasks/taskExecutions'] || []);\n    const executionLoading = computed(() => store.getters['tasks/taskExecutionLoading']);\n    const parameterText = computed(() => {\n      const params = detail.value?.parameters;\n      if (!params) return '未配置参数';\n      if (typeof params === 'string') return params;\n      try {\n        return JSON.stringify(params, null, 2);\n      } catch (error) {\n        return String(params);\n      }\n    });\n    const hasExecutionData = computed(() => Array.isArray(executions.value) && executions.value.length > 0);\n    const executionStats = computed(() => {\n      if (!hasExecutionData.value) return {\n        success: 0,\n        failed: 0\n      };\n      const success = executions.value.filter(e => e.status === 'SUCCESS').length;\n      const failed = executions.value.filter(e => e.status === 'FAILED').length;\n      return {\n        success,\n        failed\n      };\n    });\n    const successTrendOptions = computed(() => {\n      if (!hasExecutionData.value) return {};\n\n      // 将所有执行记录的 triggerTime 转换为标准字符串格式\n      const normalizedExecs = executions.value.map(exec => ({\n        ...exec,\n        triggerTime: parseTriggerTime(exec.triggerTime)\n      }));\n\n      // 按时间排序\n      const sortedExecs = [...normalizedExecs].sort((a, b) => {\n        if (!a.triggerTime) return 1;\n        if (!b.triggerTime) return -1;\n        return a.triggerTime.localeCompare(b.triggerTime);\n      });\n\n      // 根据时间范围动态格式化横坐标\n      const formatTimeLabel = timeString => {\n        if (!timeString) return '无时间';\n        try {\n          const date = dayjs(timeString);\n          if (!date.isValid()) {\n            // 降级处理：尝试提取日期部分\n            if (typeof timeString === 'string' && timeString.length >= 10) {\n              return timeString.substring(5, 10); // MM-DD\n            }\n            return '无效';\n          }\n\n          // 根据时间范围选择格式\n          switch (chartRange.value) {\n            case '24h':\n              return date.format('HH:mm');\n            case '7d':\n              return date.format('MM-DD HH:mm');\n            case '30d':\n              return date.format('MM-DD');\n            default:\n              return date.format('MM-DD HH:mm');\n          }\n        } catch (error) {\n          console.error('日期格式化错误:', error);\n          return '错误';\n        }\n      };\n      const categories = sortedExecs.map(e => formatTimeLabel(e.triggerTime));\n      const successData = sortedExecs.map(e => e.status === 'SUCCESS' ? 100 : 0);\n      const failedData = sortedExecs.map(e => e.status === 'FAILED' ? 100 : 0);\n\n      // 根据时间范围调整标签旋转角度\n      const labelRotation = chartRange.value === '30d' ? 45 : 0;\n      return {\n        color: ['#22c55e', '#ef4444'],\n        tooltip: {\n          trigger: 'axis',\n          formatter: params => params.map(p => `${p.marker}${p.seriesName}: ${p.value}%`).join('<br/>')\n        },\n        legend: {\n          data: ['成功', '失败']\n        },\n        grid: {\n          left: 50,\n          right: 24,\n          top: 40,\n          bottom: 50\n        },\n        xAxis: {\n          type: 'category',\n          data: categories,\n          axisLabel: {\n            rotate: labelRotation,\n            fontSize: 11,\n            interval: chartRange.value === '30d' ? 'auto' : 0\n          }\n        },\n        yAxis: {\n          type: 'value',\n          min: 0,\n          max: 100,\n          axisLabel: {\n            formatter: '{value}%'\n          }\n        },\n        series: [{\n          name: '成功',\n          type: 'line',\n          smooth: true,\n          areaStyle: {\n            opacity: 0.3\n          },\n          data: successData\n        }, {\n          name: '失败',\n          type: 'line',\n          smooth: true,\n          areaStyle: {\n            opacity: 0.3\n          },\n          data: failedData\n        }]\n      };\n    });\n    const durationChartOptions = computed(() => {\n      if (!hasExecutionData.value) return {};\n\n      // 转换并排序\n      const normalizedExecs = executions.value.map(exec => ({\n        ...exec,\n        triggerTime: parseTriggerTime(exec.triggerTime)\n      })).filter(e => e.triggerTime).sort((a, b) => a.triggerTime.localeCompare(b.triggerTime)).slice(-20);\n      const categories = normalizedExecs.map(e => dayjs(e.triggerTime).format('HH:mm'));\n      const durations = normalizedExecs.map(e => Number(e.duration || 0));\n      return {\n        color: ['#f97316'],\n        tooltip: {\n          trigger: 'axis',\n          formatter: params => {\n            const p = params[0];\n            return `${p.axisValue}<br/>${p.marker}耗时: ${p.value} ms`;\n          }\n        },\n        grid: {\n          left: 60,\n          right: 24,\n          top: 30,\n          bottom: 60\n        },\n        xAxis: {\n          type: 'category',\n          data: categories,\n          axisLabel: {\n            rotate: 45,\n            fontSize: 11\n          }\n        },\n        yAxis: {\n          type: 'value',\n          axisLabel: {\n            formatter: '{value} ms'\n          }\n        },\n        series: [{\n          name: '耗时',\n          type: 'bar',\n          barMaxWidth: 30,\n          data: durations,\n          itemStyle: {\n            color: params => {\n              const val = params.value;\n              if (val < 1000) return '#22c55e';\n              if (val < 5000) return '#f59e0b';\n              return '#ef4444';\n            }\n          }\n        }]\n      };\n    });\n    const loadExecutions = async () => {\n      try {\n        await store.dispatch('tasks/loadTaskExecutions', {\n          taskId,\n          page: 1,\n          size: 50,\n          range: chartRange.value\n        });\n      } catch (error) {\n        ElMessage.error(parseError(error));\n      }\n    };\n    const goBack = () => {\n      router.back();\n    };\n    const openEdit = () => {\n      drawerVisible.value = true;\n    };\n    const onDrawerVisible = visible => {\n      drawerVisible.value = visible;\n      if (!visible) {\n        submitting.value = false;\n      }\n    };\n    const submitTask = async payload => {\n      submitting.value = true;\n      try {\n        await store.dispatch('tasks/submitTask', payload);\n        await store.dispatch('tasks/loadTaskDetail', taskId);\n        drawerVisible.value = false;\n        ElMessage.success('任务已更新');\n      } catch (error) {\n        ElMessage.error(parseError(error));\n      } finally {\n        submitting.value = false;\n      }\n    };\n    const triggerTask = async () => {\n      if (!detail.value?.id || triggering.value) {\n        return;\n      }\n      triggering.value = true;\n      try {\n        await store.dispatch('tasks/triggerTask', {\n          taskId,\n          payload: {\n            manual: true,\n            operator: store.getters['auth/profile']?.username || 'anonymous'\n          }\n        });\n        ElMessage.success('执行已触发');\n        setTimeout(loadExecutions, 2000);\n      } catch (error) {\n        ElMessage.error(parseError(error));\n      } finally {\n        triggering.value = false;\n      }\n    };\n    const confirmDelete = async () => {\n      try {\n        await store.dispatch('tasks/removeTask', taskId);\n        ElMessage.success('任务已删除');\n        router.push('/tasks');\n      } catch (error) {\n        ElMessage.error(parseError(error));\n      }\n    };\n    const openLog = record => {\n      logVisible.value = true;\n\n      // 构建详细的日志信息\n      const logInfo = {\n        '执行记录ID': record.id || '-',\n        '任务ID': record.taskId || '-',\n        '触发时间': record.triggerTime || '-',\n        '执行节点': record.node || '-',\n        '执行状态': record.status || '-',\n        '执行耗时': record.duration ? `${record.duration}ms` : '-',\n        '重试次数': record.retry || 0,\n        'Trace ID': record.traceId || '-',\n        '执行结果': record.log || 'No execution result',\n        '返回参数': record.parameters ? JSON.stringify(record.parameters, null, 2) : 'No parameters returned'\n      };\n\n      // 格式化日志显示\n      const formattedLog = Object.entries(logInfo).map(([key, value]) => `【${key}】\\n${value}`).join('\\n\\n' + '='.repeat(50) + '\\n\\n');\n      activeLog.value = formattedLog;\n    };\n    const copyLog = () => {\n      if (!activeLog.value) {\n        return;\n      }\n      navigator.clipboard.writeText(activeLog.value).then(() => ElMessage.success('已复制到剪贴板')).catch(() => ElMessage.error('复制失败'));\n    };\n    const openCronHelper = () => {\n      router.push({\n        path: '/config',\n        query: {\n          tab: 'cron-tool'\n        }\n      });\n    };\n    const getDurationTagType = duration => {\n      const value = Number(duration || 0);\n      if (value < 1000) return 'success';\n      if (value < 5000) return 'warning';\n      return 'danger';\n    };\n    const typeLabel = type => {\n      const map = {\n        CRON: 'Cron定时',\n        ONE_TIME: '一次性',\n        FIXED_RATE: '固定频率'\n      };\n      return map[type] || type || '-';\n    };\n    const executorLabel = executor => {\n      const map = {\n        HTTP: 'HTTP',\n        GRPC: 'gRPC',\n        SPRING_BEAN: 'Spring Bean',\n        SHELL: 'Shell'\n      };\n      return map[executor] || executor || '-';\n    };\n    const routeLabel = route => {\n      const map = {\n        ROUND_ROBIN: '轮询',\n        CONSISTENT_HASH: '一致性哈希',\n        SHARDING: '分片',\n        FIXED_NODE: '固定节点'\n      };\n      return map[route] || route || '-';\n    };\n    const retryLabel = retry => {\n      const map = {\n        NONE: '不重试',\n        FIXED_INTERVAL: '固定间隔',\n        EXP_BACKOFF: '指数退避'\n      };\n      return map[retry] || retry || '固定间隔';\n    };\n    const concurrencyLabel = policy => {\n      const map = {\n        PARALLEL: '并行',\n        SERIAL: '串行',\n        DISCARD: '丢弃'\n      };\n      return map[policy] || policy || '并行';\n    };\n    const __returned__ = {\n      store,\n      route,\n      router,\n      taskId,\n      drawerVisible,\n      submitting,\n      logVisible,\n      activeLog,\n      triggering,\n      detailLoading,\n      chartRange,\n      groupOptions,\n      ownerOptions,\n      tagOptions,\n      parseError,\n      parseTriggerTime,\n      detail,\n      executions,\n      executionLoading,\n      parameterText,\n      hasExecutionData,\n      executionStats,\n      successTrendOptions,\n      durationChartOptions,\n      loadExecutions,\n      goBack,\n      openEdit,\n      onDrawerVisible,\n      submitTask,\n      triggerTask,\n      confirmDelete,\n      openLog,\n      copyLog,\n      openCronHelper,\n      getDurationTagType,\n      typeLabel,\n      executorLabel,\n      routeLabel,\n      retryLabel,\n      concurrencyLabel,\n      computed,\n      onMounted,\n      ref,\n      get useRoute() {\n        return useRoute;\n      },\n      get useRouter() {\n        return useRouter;\n      },\n      get useStore() {\n        return useStore;\n      },\n      get ElMessage() {\n        return ElMessage;\n      },\n      get dayjs() {\n        return dayjs;\n      },\n      StatusTag,\n      TaskFormDrawer,\n      TaskDependencyGraph,\n      BaseChart\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["computed","onMounted","ref","useRoute","useRouter","useStore","ElMessage","dayjs","StatusTag","TaskFormDrawer","TaskDependencyGraph","BaseChart","store","route","router","taskId","params","drawerVisible","submitting","logVisible","activeLog","triggering","detailLoading","chartRange","groupOptions","label","value","ownerOptions","tagOptions","parseError","error","response","data","message","parseTriggerTime","triggerTime","year","monthValue","month","dayOfMonth","day","hour","minute","second","y","m","d","h","min","s","monthMap","toUpperCase","parseInt","date","Date","isValid","format","console","String","dispatch","loadExecutions","detail","getters","executions","executionLoading","parameterText","parameters","JSON","stringify","hasExecutionData","Array","isArray","length","executionStats","success","failed","filter","e","status","successTrendOptions","normalizedExecs","map","exec","sortedExecs","sort","a","b","localeCompare","formatTimeLabel","timeString","substring","categories","successData","failedData","labelRotation","color","tooltip","trigger","formatter","p","marker","seriesName","join","legend","grid","left","right","top","bottom","xAxis","type","axisLabel","rotate","fontSize","interval","yAxis","max","series","name","smooth","areaStyle","opacity","durationChartOptions","slice","durations","Number","duration","axisValue","barMaxWidth","itemStyle","val","page","size","range","goBack","back","openEdit","onDrawerVisible","visible","submitTask","payload","triggerTask","id","manual","operator","username","setTimeout","confirmDelete","push","openLog","record","logInfo","node","retry","traceId","log","formattedLog","Object","entries","key","repeat","copyLog","navigator","clipboard","writeText","then","catch","openCronHelper","path","query","tab","getDurationTagType","typeLabel","CRON","ONE_TIME","FIXED_RATE","executorLabel","executor","HTTP","GRPC","SPRING_BEAN","SHELL","routeLabel","ROUND_ROBIN","CONSISTENT_HASH","SHARDING","FIXED_NODE","retryLabel","NONE","FIXED_INTERVAL","EXP_BACKOFF","concurrencyLabel","policy","PARALLEL","SERIAL","DISCARD"],"sources":["D:/桌面/项目/分布式任务调度系统/SkyTask-main/SkyTask-main/skytask-frontend/src/views/TaskDetailView.vue"],"sourcesContent":["<template>\n  <div class=\"task-detail\">\n    <el-page-header @back=\"goBack\">\n      <template #content>\n        <div class=\"header\">\n          <span class=\"header__title\">{{ detail?.name || '任务详情' }}</span>\n          <StatusTag :status=\"detail?.enabled ? 'SUCCESS' : 'DISABLED'\" />\n          <el-tag v-if=\"detail?.group\" type=\"info\" effect=\"plain\">{{ detail.group }}</el-tag>\n        </div>\n      </template>\n      <template #extra>\n        <el-space>\n          <el-button type=\"primary\" :loading=\"triggering\" @click=\"triggerTask\">立即运行</el-button>\n          <el-button @click=\"openEdit\">编辑任务</el-button>\n          <el-popconfirm\n            title=\"确定删除此任务吗？\"\n            confirm-button-text=\"确认\"\n            cancel-button-text=\"取消\"\n            @confirm=\"confirmDelete\"\n          >\n            <template #reference>\n              <el-button type=\"danger\">删除</el-button>\n            </template>\n          </el-popconfirm>\n        </el-space>\n      </template>\n    </el-page-header>\n\n    <div v-loading=\"detailLoading\" class=\"content\">\n      <section class=\"card detail-card\">\n        <div class=\"detail-card__section\">\n          <h3>基本信息</h3>\n          <el-descriptions :column=\"2\" size=\"small\" border>\n            <el-descriptions-item label=\"任务ID\">{{ detail?.id || '-' }}</el-descriptions-item>\n            <el-descriptions-item label=\"任务类型\">{{ typeLabel(detail?.type) }}</el-descriptions-item>\n            <el-descriptions-item label=\"执行器\">{{ executorLabel(detail?.executorType) }}</el-descriptions-item>\n            <el-descriptions-item label=\"Cron表达式\">\n              <el-tag v-if=\"detail?.cronExpr\" type=\"success\" effect=\"plain\">{{ detail.cronExpr }}</el-tag>\n              <span v-else>-</span>\n            </el-descriptions-item>\n            <el-descriptions-item label=\"负责人\">{{ detail?.owner || '-' }}</el-descriptions-item>\n            <el-descriptions-item label=\"超时时间\">{{ detail?.timeout || 300 }} 秒</el-descriptions-item>\n            <el-descriptions-item label=\"创建时间\">{{ detail?.createdAt || '-' }}</el-descriptions-item>\n            <el-descriptions-item label=\"更新时间\">{{ detail?.updatedAt || '-' }}</el-descriptions-item>\n          </el-descriptions>\n        </div>\n\n        <div class=\"detail-card__section\">\n          <h3>调度策略</h3>\n          <el-descriptions :column=\"2\" size=\"small\" border>\n            <el-descriptions-item label=\"路由策略\">{{ routeLabel(detail?.routeStrategy) }}</el-descriptions-item>\n            <el-descriptions-item label=\"最大重试次数\">{{ detail?.maxRetry ?? 0 }}</el-descriptions-item>\n            <el-descriptions-item label=\"重试策略\">{{ retryLabel(detail?.retryPolicy) }}</el-descriptions-item>\n            <el-descriptions-item label=\"分片数\">{{ detail?.shardCount ?? 1 }}</el-descriptions-item>\n            <el-descriptions-item label=\"幂等键\">{{ detail?.idempotentKey || '-' }}</el-descriptions-item>\n            <el-descriptions-item label=\"并发策略\">{{ concurrencyLabel(detail?.concurrencyPolicy) }}</el-descriptions-item>\n          </el-descriptions>\n        </div>\n\n        <div class=\"detail-card__section\">\n          <h3>任务参数</h3>\n          <el-input\n            v-model=\"parameterText\"\n            type=\"textarea\"\n            :rows=\"5\"\n            readonly\n            placeholder=\"未配置参数\"\n          />\n        </div>\n      </section>\n\n      <section class=\"card chart-card\">\n        <div class=\"chart-card__header\">\n          <h3>执行成功趋势</h3>\n          <el-radio-group v-model=\"chartRange\" size=\"small\" @change=\"loadExecutions\">\n            <el-radio-button label=\"24h\">24小时</el-radio-button>\n            <el-radio-button label=\"7d\">7天</el-radio-button>\n            <el-radio-button label=\"30d\">30天</el-radio-button>\n          </el-radio-group>\n        </div>\n        <div v-loading=\"executionLoading\" class=\"chart-content\">\n          <BaseChart v-if=\"hasExecutionData\" :options=\"successTrendOptions\" class=\"chart\" />\n          <el-empty v-else description=\"暂无执行数据\" />\n        </div>\n      </section>\n\n      <section class=\"card chart-card\">\n        <div class=\"chart-card__header\">\n          <h3>执行耗时（最近20次）</h3>\n          <el-tag size=\"small\" type=\"info\">最近20次执行</el-tag>\n        </div>\n        <div v-loading=\"executionLoading\" class=\"chart-content\">\n          <BaseChart v-if=\"hasExecutionData\" :options=\"durationChartOptions\" class=\"chart\" />\n          <el-empty v-else description=\"暂无执行数据\" />\n        </div>\n      </section>\n\n      <section class=\"card execution-card\">\n        <div class=\"execution-card__header\">\n          <h3>最近执行记录</h3>\n          <el-space>\n            <el-tag size=\"small\">\n              成功: {{ executionStats.success }} | 失败: {{ executionStats.failed }}\n            </el-tag>\n            <el-button size=\"small\" @click=\"loadExecutions\">刷新</el-button>\n          </el-space>\n        </div>\n        <el-table :data=\"executions\" height=\"320\" v-loading=\"executionLoading\">\n          <el-table-column prop=\"triggerTime\" label=\"触发时间\" width=\"160\" />\n          <el-table-column prop=\"node\" label=\"执行节点\" width=\"140\" show-overflow-tooltip />\n          <el-table-column label=\"状态\" width=\"110\">\n            <template #default=\"{ row }\">\n              <StatusTag :status=\"row.status || 'UNKNOWN'\" />\n            </template>\n          </el-table-column>\n          <el-table-column prop=\"duration\" label=\"耗时\" width=\"110\">\n            <template #default=\"{ row }\">\n              <el-tag :type=\"getDurationTagType(row.duration)\" size=\"small\">\n                {{ row.duration || 0 }} ms\n              </el-tag>\n            </template>\n          </el-table-column>\n          <el-table-column prop=\"retry\" label=\"重试\" width=\"80\" />\n          <el-table-column prop=\"traceId\" label=\"追踪ID\" min-width=\"160\" show-overflow-tooltip />\n          <el-table-column label=\"操作\" width=\"110\" fixed=\"right\">\n            <template #default=\"{ row }\">\n              <el-button link type=\"primary\" size=\"small\" @click=\"openLog(row)\">查看日志</el-button>\n            </template>\n          </el-table-column>\n          <template #empty>\n            <el-empty description=\"暂无执行记录\" />\n          </template>\n        </el-table>\n      </section>\n\n      <section class=\"card dependency-card\">\n        <div class=\"dependency-card__header\">\n          <h3>上游依赖</h3>\n          <el-tag v-if=\"detail?.dependencies?.length\" size=\"small\" type=\"info\">\n            {{ detail.dependencies.length }} 个任务\n          </el-tag>\n        </div>\n        <TaskDependencyGraph\n          :task-name=\"detail?.name\"\n          :dependencies=\"detail?.dependencies || []\"\n        />\n        <el-timeline v-if=\"detail?.dependencies?.length\" class=\"dependency-timeline\">\n          <el-timeline-item\n            v-for=\"dep in detail.dependencies\"\n            :key=\"dep.id\"\n            :timestamp=\"dep.triggerType || '手动'\"\n            :type=\"dep.status === 'SUCCESS' ? 'success' : dep.status === 'FAILED' ? 'danger' : 'info'\"\n          >\n            <div class=\"dependency-item\">\n              <strong>{{ dep.name }}</strong>\n              <span>节点: {{ dep.node || '-' }}</span>\n              <span>状态: <StatusTag :status=\"dep.status || 'UNKNOWN'\" /></span>\n              <el-tag v-if=\"dep.cronExpr\" size=\"small\" effect=\"plain\">{{ dep.cronExpr }}</el-tag>\n            </div>\n          </el-timeline-item>\n        </el-timeline>\n      </section>\n    </div>\n\n    <TaskFormDrawer\n      v-model:visible=\"drawerVisible\"\n      :model-value=\"detail\"\n      :group-options=\"groupOptions\"\n      :owner-options=\"ownerOptions\"\n      :tag-options=\"tagOptions\"\n      :submitting=\"submitting\"\n      @submit=\"submitTask\"\n      @update:visible=\"onDrawerVisible\"\n      @cron-helper=\"openCronHelper\"\n    />\n\n    <el-drawer\n      v-model=\"logVisible\"\n      title=\"执行日志\"\n      size=\"40%\"\n    >\n      <template #default>\n        <pre class=\"log\">{{ activeLog || '暂无日志内容' }}</pre>\n      </template>\n      <template #footer>\n        <el-space>\n          <el-button type=\"primary\" @click=\"copyLog\" :disabled=\"!activeLog\">复制</el-button>\n          <el-button @click=\"logVisible = false\">关闭</el-button>\n        </el-space>\n      </template>\n    </el-drawer>\n  </div>\n</template>\n\n<script setup>\nimport { computed, onMounted, ref } from 'vue';\nimport { useRoute, useRouter } from 'vue-router';\nimport { useStore } from 'vuex';\nimport { ElMessage } from 'element-plus';\nimport dayjs from 'dayjs';\nimport StatusTag from '@/components/common/StatusTag.vue';\nimport TaskFormDrawer from '@/components/task/TaskFormDrawer.vue';\nimport TaskDependencyGraph from '@/components/task/TaskDependencyGraph.vue';\nimport BaseChart from '@/components/charts/BaseChart.vue';\n\nconst store = useStore();\nconst route = useRoute();\nconst router = useRouter();\n\nconst taskId = route.params.taskId;\nconst drawerVisible = ref(false);\nconst submitting = ref(false);\nconst logVisible = ref(false);\nconst activeLog = ref('');\nconst triggering = ref(false);\nconst detailLoading = ref(false);\nconst chartRange = ref('24h');\n\nconst groupOptions = [\n  { label: 'Data Report', value: 'DATA_REPORT' },\n  { label: 'Realtime Risk', value: 'RISK_CONTROL' },\n  { label: 'Marketing', value: 'MARKETING' },\n  { label: 'Recommendation', value: 'RECOMMEND' }\n];\n\nconst ownerOptions = [\n  { label: 'Alice - Data Platform', value: 'alice' },\n  { label: 'Bob - Marketing', value: 'bob' },\n  { label: 'Carol - Settlement', value: 'carol' },\n  { label: 'David - Recommendation', value: 'david' }\n];\n\nconst tagOptions = ['report', 'risk', 'cache', 'recommend', 'marketing', 'settlement'];\n\nconst parseError = (error) =>\n  error?.response?.data?.message || error?.message || '操作失败，请稍后重试';\n\n// 统一的日期转换函数\nconst parseTriggerTime = (triggerTime) => {\n  if (!triggerTime) {\n    return null;\n  }\n  \n  // 如果已经是字符串，直接返回\n  if (typeof triggerTime === 'string') {\n    return triggerTime;\n  }\n  \n  // 如果是对象（OffsetDateTime 序列化结果），尝试转换\n  if (typeof triggerTime === 'object') {\n    const { year, monthValue, month, dayOfMonth, day, hour, minute, second } = triggerTime;\n    \n    const y = year;\n    let m = monthValue || month;\n    const d = dayOfMonth || day;\n    const h = hour || 0;\n    const min = minute || 0;\n    const s = second || 0;\n    \n    // 如果 month 是字符串（如\"OCTOBER\"），转换为数字\n    if (typeof m === 'string') {\n      const monthMap = {\n        'JANUARY': 1, 'FEBRUARY': 2, 'MARCH': 3, 'APRIL': 4,\n        'MAY': 5, 'JUNE': 6, 'JULY': 7, 'AUGUST': 8,\n        'SEPTEMBER': 9, 'OCTOBER': 10, 'NOVEMBER': 11, 'DECEMBER': 12\n      };\n      m = monthMap[m.toUpperCase()] || parseInt(m);\n    }\n    \n    if (y && m && d) {\n      try {\n        // 使用 JavaScript Date 对象构建日期，确保兼容性\n        const date = dayjs(new Date(y, m - 1, d, h, min, s));\n        \n        if (date.isValid()) {\n          return date.format('YYYY-MM-DDTHH:mm:ss');\n        }\n      } catch (error) {\n        console.error('日期构建异常:', error);\n      }\n    }\n  }\n  \n  return String(triggerTime);\n};\n\nonMounted(async () => {\n  detailLoading.value = true;\n  try {\n    await store.dispatch('tasks/loadTaskDetail', taskId);\n    await loadExecutions();\n  } catch (error) {\n    ElMessage.error(parseError(error));\n  } finally {\n    detailLoading.value = false;\n  }\n});\n\nconst detail = computed(() => store.getters['tasks/currentTask'] || {});\nconst executions = computed(() => store.getters['tasks/taskExecutions'] || []);\nconst executionLoading = computed(() => store.getters['tasks/taskExecutionLoading']);\n\nconst parameterText = computed(() => {\n  const params = detail.value?.parameters;\n  if (!params) return '未配置参数';\n  if (typeof params === 'string') return params;\n  try {\n    return JSON.stringify(params, null, 2);\n  } catch (error) {\n    return String(params);\n  }\n});\n\nconst hasExecutionData = computed(\n  () => Array.isArray(executions.value) && executions.value.length > 0\n);\n\nconst executionStats = computed(() => {\n  if (!hasExecutionData.value) return { success: 0, failed: 0 };\n  const success = executions.value.filter((e) => e.status === 'SUCCESS').length;\n  const failed = executions.value.filter((e) => e.status === 'FAILED').length;\n  return { success, failed };\n});\n\nconst successTrendOptions = computed(() => {\n  if (!hasExecutionData.value) return {};\n\n  // 将所有执行记录的 triggerTime 转换为标准字符串格式\n  const normalizedExecs = executions.value.map(exec => ({\n    ...exec,\n    triggerTime: parseTriggerTime(exec.triggerTime)\n  }));\n\n  // 按时间排序\n  const sortedExecs = [...normalizedExecs].sort((a, b) => {\n    if (!a.triggerTime) return 1;\n    if (!b.triggerTime) return -1;\n    return a.triggerTime.localeCompare(b.triggerTime);\n  });\n  \n  // 根据时间范围动态格式化横坐标\n  const formatTimeLabel = (timeString) => {\n    if (!timeString) return '无时间';\n    \n    try {\n      const date = dayjs(timeString);\n      \n      if (!date.isValid()) {\n        // 降级处理：尝试提取日期部分\n        if (typeof timeString === 'string' && timeString.length >= 10) {\n          return timeString.substring(5, 10); // MM-DD\n        }\n        return '无效';\n      }\n      \n      // 根据时间范围选择格式\n        switch (chartRange.value) {\n          case '24h':\n          return date.format('HH:mm');\n          case '7d':\n          return date.format('MM-DD HH:mm');\n          case '30d':\n          return date.format('MM-DD');\n          default:\n          return date.format('MM-DD HH:mm');\n      }\n    } catch (error) {\n      console.error('日期格式化错误:', error);\n      return '错误';\n    }\n  };\n  \n  const categories = sortedExecs.map(e => formatTimeLabel(e.triggerTime));\n  const successData = sortedExecs.map((e) => (e.status === 'SUCCESS' ? 100 : 0));\n  const failedData = sortedExecs.map((e) => (e.status === 'FAILED' ? 100 : 0));\n\n  // 根据时间范围调整标签旋转角度\n  const labelRotation = chartRange.value === '30d' ? 45 : 0;\n\n  return {\n    color: ['#22c55e', '#ef4444'],\n    tooltip: {\n      trigger: 'axis',\n      formatter: (params) =>\n        params.map((p) => `${p.marker}${p.seriesName}: ${p.value}%`).join('<br/>')\n    },\n    legend: {\n      data: ['成功', '失败']\n    },\n    grid: { left: 50, right: 24, top: 40, bottom: 50 },\n    xAxis: {\n      type: 'category',\n      data: categories,\n      axisLabel: { \n        rotate: labelRotation, \n        fontSize: 11,\n        interval: chartRange.value === '30d' ? 'auto' : 0\n      }\n    },\n    yAxis: {\n      type: 'value',\n      min: 0,\n      max: 100,\n      axisLabel: { formatter: '{value}%' }\n    },\n    series: [\n      {\n        name: '成功',\n        type: 'line',\n        smooth: true,\n        areaStyle: { opacity: 0.3 },\n        data: successData\n      },\n      {\n        name: '失败',\n        type: 'line',\n        smooth: true,\n        areaStyle: { opacity: 0.3 },\n        data: failedData\n      }\n    ]\n  };\n});\n\nconst durationChartOptions = computed(() => {\n  if (!hasExecutionData.value) return {};\n\n  // 转换并排序\n  const normalizedExecs = executions.value\n    .map(exec => ({\n      ...exec,\n      triggerTime: parseTriggerTime(exec.triggerTime)\n    }))\n    .filter(e => e.triggerTime)\n    .sort((a, b) => a.triggerTime.localeCompare(b.triggerTime))\n    .slice(-20);\n\n  const categories = normalizedExecs.map((e) => dayjs(e.triggerTime).format('HH:mm'));\n  const durations = normalizedExecs.map((e) => Number(e.duration || 0));\n\n  return {\n    color: ['#f97316'],\n    tooltip: {\n      trigger: 'axis',\n      formatter: (params) => {\n        const p = params[0];\n        return `${p.axisValue}<br/>${p.marker}耗时: ${p.value} ms`;\n      }\n    },\n    grid: { left: 60, right: 24, top: 30, bottom: 60 },\n    xAxis: {\n      type: 'category',\n      data: categories,\n      axisLabel: { rotate: 45, fontSize: 11 }\n    },\n    yAxis: {\n      type: 'value',\n      axisLabel: { formatter: '{value} ms' }\n    },\n    series: [\n      {\n        name: '耗时',\n        type: 'bar',\n        barMaxWidth: 30,\n        data: durations,\n        itemStyle: {\n          color: (params) => {\n            const val = params.value;\n            if (val < 1000) return '#22c55e';\n            if (val < 5000) return '#f59e0b';\n            return '#ef4444';\n          }\n        }\n      }\n    ]\n  };\n});\n\nconst loadExecutions = async () => {\n  try {\n    await store.dispatch('tasks/loadTaskExecutions', {\n      taskId,\n      page: 1,\n      size: 50,\n      range: chartRange.value\n    });\n  } catch (error) {\n    ElMessage.error(parseError(error));\n  }\n};\n\nconst goBack = () => {\n  router.back();\n};\n\nconst openEdit = () => {\n  drawerVisible.value = true;\n};\n\nconst onDrawerVisible = (visible) => {\n  drawerVisible.value = visible;\n  if (!visible) {\n    submitting.value = false;\n  }\n};\n\nconst submitTask = async (payload) => {\n  submitting.value = true;\n  try {\n    await store.dispatch('tasks/submitTask', payload);\n    await store.dispatch('tasks/loadTaskDetail', taskId);\n    drawerVisible.value = false;\n    ElMessage.success('任务已更新');\n  } catch (error) {\n    ElMessage.error(parseError(error));\n  } finally {\n    submitting.value = false;\n  }\n};\n\nconst triggerTask = async () => {\n  if (!detail.value?.id || triggering.value) {\n    return;\n  }\n  triggering.value = true;\n  try {\n    await store.dispatch('tasks/triggerTask', {\n      taskId,\n      payload: {\n        manual: true,\n        operator: store.getters['auth/profile']?.username || 'anonymous'\n      }\n    });\n    ElMessage.success('执行已触发');\n    setTimeout(loadExecutions, 2000);\n  } catch (error) {\n    ElMessage.error(parseError(error));\n  } finally {\n    triggering.value = false;\n  }\n};\n\nconst confirmDelete = async () => {\n  try {\n    await store.dispatch('tasks/removeTask', taskId);\n    ElMessage.success('任务已删除');\n    router.push('/tasks');\n  } catch (error) {\n    ElMessage.error(parseError(error));\n  }\n};\n\nconst openLog = (record) => {\n  logVisible.value = true;\n  \n  // 构建详细的日志信息\n  const logInfo = {\n    '执行记录ID': record.id || '-',\n    '任务ID': record.taskId || '-',\n    '触发时间': record.triggerTime || '-',\n    '执行节点': record.node || '-',\n    '执行状态': record.status || '-',\n    '执行耗时': record.duration ? `${record.duration}ms` : '-',\n    '重试次数': record.retry || 0,\n    'Trace ID': record.traceId || '-',\n    '执行结果': record.log || 'No execution result',\n    '返回参数': record.parameters ? JSON.stringify(record.parameters, null, 2) : 'No parameters returned'\n  };\n  \n  // 格式化日志显示\n  const formattedLog = Object.entries(logInfo)\n    .map(([key, value]) => `【${key}】\\n${value}`)\n    .join('\\n\\n' + '='.repeat(50) + '\\n\\n');\n  \n  activeLog.value = formattedLog;\n};\n\nconst copyLog = () => {\n  if (!activeLog.value) {\n    return;\n  }\n  navigator.clipboard\n    .writeText(activeLog.value)\n    .then(() => ElMessage.success('已复制到剪贴板'))\n    .catch(() => ElMessage.error('复制失败'));\n};\n\nconst openCronHelper = () => {\n  router.push({ path: '/config', query: { tab: 'cron-tool' } });\n};\n\nconst getDurationTagType = (duration) => {\n  const value = Number(duration || 0);\n  if (value < 1000) return 'success';\n  if (value < 5000) return 'warning';\n  return 'danger';\n};\n\nconst typeLabel = (type) => {\n  const map = {\n    CRON: 'Cron定时',\n    ONE_TIME: '一次性',\n    FIXED_RATE: '固定频率'\n  };\n  return map[type] || type || '-';\n};\n\nconst executorLabel = (executor) => {\n  const map = {\n    HTTP: 'HTTP',\n    GRPC: 'gRPC',\n    SPRING_BEAN: 'Spring Bean',\n    SHELL: 'Shell'\n  };\n  return map[executor] || executor || '-';\n};\n\nconst routeLabel = (route) => {\n  const map = {\n    ROUND_ROBIN: '轮询',\n    CONSISTENT_HASH: '一致性哈希',\n    SHARDING: '分片',\n    FIXED_NODE: '固定节点'\n  };\n  return map[route] || route || '-';\n};\n\nconst retryLabel = (retry) => {\n  const map = {\n    NONE: '不重试',\n    FIXED_INTERVAL: '固定间隔',\n    EXP_BACKOFF: '指数退避'\n  };\n  return map[retry] || retry || '固定间隔';\n};\n\nconst concurrencyLabel = (policy) => {\n  const map = {\n    PARALLEL: '并行',\n    SERIAL: '串行',\n    DISCARD: '丢弃'\n  };\n  return map[policy] || policy || '并行';\n};\n</script>\n\n<style scoped lang=\"scss\">\n.task-detail {\n  display: flex;\n  flex-direction: column;\n  gap: 20px;\n}\n\n.header {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n\n  &__title {\n    font-size: 20px;\n    font-weight: 600;\n  }\n}\n\n.content {\n  display: grid;\n  grid-template-columns: repeat(2, minmax(0, 1fr));\n  gap: 20px;\n}\n\n.detail-card {\n  grid-column: span 2;\n  display: flex;\n  flex-direction: column;\n  gap: 24px;\n\n  &__section {\n    h3 {\n      margin: 0 0 16px;\n      font-size: 16px;\n      font-weight: 600;\n      color: #0f172a;\n    }\n  }\n}\n\n.chart-card,\n.execution-card,\n.dependency-card {\n  h3 {\n    margin: 0;\n    font-size: 16px;\n    font-weight: 600;\n    color: #0f172a;\n  }\n}\n\n.chart-card__header,\n.execution-card__header,\n.dependency-card__header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  margin-bottom: 16px;\n}\n\n.chart-content {\n  min-height: 280px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.chart {\n  width: 100%;\n  height: 280px;\n}\n\n.execution-card {\n  grid-column: span 2;\n}\n\n.dependency-card {\n  grid-column: span 2;\n}\n\n.dependency-timeline {\n  margin-top: 16px;\n}\n\n.dependency-item {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  font-size: 13px;\n  color: #475569;\n  flex-wrap: wrap;\n\n  strong {\n    font-weight: 600;\n    color: #1e293b;\n  }\n}\n\n.log {\n  margin: 0;\n  font-family: 'Fira Code', 'Consolas', 'Monaco', monospace;\n  font-size: 13px;\n  line-height: 1.6;\n  white-space: pre-wrap;\n  word-wrap: break-word;\n  background: #0f172a;\n  color: #e2e8f0;\n  padding: 16px;\n  border-radius: 8px;\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}